<script is:inline>
    function initializeGiscus() {
        // Remove existing giscus if it exists
        const existingGiscus = document.querySelector('.giscus, iframe.giscus-frame');
        if (existingGiscus) {
            existingGiscus.remove();
        }

        // Remove existing script
        const existingScript = document.getElementById('giscusComments');
        if (existingScript && existingScript.tagName === 'SCRIPT') {
            existingScript.remove();
        }

        // Create new script
        const script = document.createElement('script');
        script.id = 'giscusComments';
        script.src = 'https://giscus.app/client.js';
        script.setAttribute('data-repo', 'yogeshpaliyal/yogeshpaliyal.com');
        script.setAttribute('data-repo-id', 'R_kgDONQlO3w');
        script.setAttribute('data-category', 'Comments');
        script.setAttribute('data-category-id', 'DIC_kwDONQlO384CkWBb');
        script.setAttribute('data-mapping', 'pathname');
        script.setAttribute('data-strict', '0');
        script.setAttribute('data-reactions-enabled', '1');
        script.setAttribute('data-emit-metadata', '0');
        script.setAttribute('data-input-position', 'bottom');
        script.setAttribute('data-lang', 'en');
        script.setAttribute('data-loading', 'lazy');
        script.setAttribute('crossorigin', 'anonymous');
        script.async = true;

        // Set theme based on current theme
        const theme = document.documentElement.getAttribute('data-theme');
        const giscusTheme = theme === 'light' ? 'light' : 'noborder_gray';
        script.setAttribute('data-theme', giscusTheme);

        // Append script to container
        const container = document.getElementById('giscus-container');
        if (container) {
            container.appendChild(script);
        }
    }

    function updateGiscusTheme() {
        const theme = document.documentElement.getAttribute('data-theme');
        const giscusTheme = theme === 'light' ? 'light' : 'noborder_gray';

        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        
        const themeMsg = {
            setConfig: {
                theme: giscusTheme,
                reactionsEnabled: true,
            }
        }
        iframe.contentWindow?.postMessage({ giscus: themeMsg}, 'https://giscus.app');
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', initializeGiscus);
    
    // Re-initialize on navigation (for SPAs)
    document.addEventListener('astro:page-load', initializeGiscus);

    // Watch for theme changes
    const observer = new MutationObserver((mutations) => {
        mutations.forEach((mutation) => {
            if (mutation.attributeName === 'data-theme') {
                updateGiscusTheme();
            }
        });
    });

    observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['data-theme']
    });
</script>


<section class="mx-auto mt-12">
  <div id="giscus-container"></div>
</section>
